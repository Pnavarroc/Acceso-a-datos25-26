üîπ NIVEL 1 ‚Äì Sin lookup (calentar)
1Ô∏è‚É£ Buscar libros publicados despu√©s del 2010.

db.libros_ref.find(
    {anioPublicacion: {$gt: 2010}}
)

2Ô∏è‚É£ Buscar libros cuyo precio sea mayor a 40‚Ç¨.

db.libros_ref.find(
    {precio: {$gt: 40}}
)

3Ô∏è‚É£ Buscar libros que tengan m√°s de un autor.

(Pista: array de ObjectId)

db.libros_ref.find(
    {"autores.1": {$exists:true}}
)

4Ô∏è‚É£ Buscar autores de nacionalidad "Estados Unidos".

db.autores.find(
    {nacionalidad: "Estados Unidos"}
)

5Ô∏è‚É£ Mostrar solo el nombre y nacionalidad de los autores.

(Proyecci√≥n)

db.autores.aggregate([
    {
        $project:{
            "nombre":1,
            "nacionalidad":1
        }
    }
])

üîπ NIVEL 2 ‚Äì Primeros $lookup
6Ô∏è‚É£ Mostrar cada libro junto con los datos completos de sus autores.

(Pista: $lookup)

db.libros_ref.aggregate([
    {
        $lookup:{
            from: "autores",
            localField: "autores",
            foreignField:"_id",
            as : "autor"
        }
    }
])

7Ô∏è‚É£ Mostrar solo:

t√≠tulo

nombre del autor

(Usando $lookup + $project)

db.libros_ref.aggregate([
    {
        $lookup:{
            from: "autores",
            localField: "autores",
            foreignField:"_id",
            as : "autor"
        }
    },
    {
        $project:{
            "titulo":1,
            "autor.nombre":1,
            "_id":0
        }
    }
])

8Ô∏è‚É£ Mostrar libros cuyos autores sean de "Espa√±a".

(Pista: $lookup ‚Üí $match sobre campo del autor)

db.libros_ref.aggregate([
    {
        $lookup:{
            from: "autores",
            localField: "autores",
            foreignField:"_id",
            as : "autor"
        }
    },
    {
        $match:{
            "autor.nacionalidad":"Espa√±a"
        }
    },
    {
        $project:{
            "titulo":1,
            "autor.nombre":1,
            "autor.nacionalidad":1,
            "_id":0
        }
    }
])

9Ô∏è‚É£ Obtener libros escritos por autores de "Estados Unidos".

(Ojo con el orden de $lookup y $match)

db.libros_ref.aggregate([
    {
        $lookup:{
            from: "autores",
            localField: "autores",
            foreignField:"_id",
            as : "autor"
        }
    },
    {
        $match:{
            "autor.nacionalidad":"Estados Unidos"
        }
    },
    {
        $project:{
            "titulo":1,
            "autor.nombre":1,
            "autor.nacionalidad":1,
            "_id":0
        }
    }
])

üîü Mostrar los libros junto con el n√∫mero de autores que tienen.

(Pista: $size despu√©s del $lookup)

db.libros_ref.aggregate([
    {
        $project:{
            "titulo":1,
            numeroAutores: {$size:"$autores"},
            "_id":0
        }
    }
])

üî• NIVEL 3 ‚Äì Aggregate m√°s interesante
11Ô∏è‚É£ Contar cu√°ntos libros hay por nacionalidad de autor.

Resultado tipo:

Estados Unidos ‚Üí X
Espa√±a ‚Üí Y

db.libros_ref.aggregate([
    {
        $lookup:{
            from: "autores",
            localField:"autores",
            foreignField:"_id",
            as :"autor"
        }
    },
    {$unwind: "$autor"},
    {
        $group:{
            _id:"$autor.nacionalidad",
            numeroLibros: {$sum:1}
        }
    }

])


(Pista: $lookup + $unwind + $group)

12Ô∏è‚É£ Calcular el precio promedio de los libros por nacionalidad de autor.

db.libros_ref.aggregate([
    {
        $lookup:{
            from: "autores",
            localField:"autores",
            foreignField:"_id",
            as :"autor"
        }
    },
    {$unwind: "$autor"},
    {
        $group:{
            _id:"$autor.nacionalidad",
            promedio: {$avg:"$precio"}
        }
    }

])

13Ô∏è‚É£ Obtener el autor que ha participado en m√°s libros.

(Pista: agrupar por _id del autor)
db.libros_ref.aggregate([
    { $unwind: "$autores" },
    {
        $group:{
            _id:"$autores",
            numeroLibros: {$sum:1}
        }
    },
    { $sort:{ numeroLibros:-1 } },
    { $limit:1 },
    {
        $lookup:{
            from:"autores",
            localField:"_id",
            foreignField:"_id",
            as:"autor"
        }
    },
    { $unwind:"$autor" },
    {
        $project:{
            _id:0,
            nombre:"$autor.nombre",
            numeroLibros:1
        }
    }
])

14Ô∏è‚É£ Obtener el libro m√°s caro junto con el nombre de su autor.

db.libros_ref.aggregate([
    {
        $sort:{
            "precio":-1
        }
    },
    {$limit:1},
    {
        $lookup:{
            from: "autores",
            localField:"autores",
            foreignField:"_id",
            as: "autor"
        }
    },
    {
        $project:{
            "titulo":1,
            "precio":1,
            "anioPublicacion":1,
            "autor.nombre":1,
            "_id":0
        }
    }
])

15Ô∏è‚É£ Mostrar las editoriales y el n√∫mero total de autores distintos que han publicado en cada una.


db.libros_ref.aggregate([
    { $unwind:"$autores" },
    {
        $group:{
            _id:"$editorial",
            autoresDistintos: { $addToSet:"$autores" }
        }
    },
    {
        $project:{
            editorial:"$_id",
            numeroAutores: { $size:"$autoresDistintos" },
            _id:0
        }
    }
])
(Esta es nivel examen serio)